# project

先頭に定義。
名前、使う言語(c, cpp...)、コンパイラの全体設定(c++20)など。

```meson.build
project('hello', ['c', 'cpp'],
version: '1.0.0',
default_options: [
    'cpp_std=c++20',
])
```

https://mesonbuild.com/Reference-manual_functions.html#project

https://mesonbuild.com/Reference-manual_returned_subproject.html

root project は暗黙裡に `this` として参照されている感じぽい？

## default_options
project 全体の設定を変更する。

https://mesonbuild.com/Builtin-options.html

:::note warn
project の default_options 変更時は `meson setup --wipe` が必要

`ninja`, `meson compile` するだけでは反映されないので注意。
また `meson setup --reconfigure` ではだめ。
:::

### default_library
static と shared を選択する。デフォルトは shared ?

```meson.build
project(
default_options: ['default_library=static']
)
```

のように指定できる。

## project init
空プロジェクトの生成

https://mesonbuild.com/Project-templates.html

## compile options
### include

:::note alert

デフォルトでカレントフォルダが `-I` に追加される。
危ない。
システムのヘッダと同名のファイルがローカルに存在した場合に、意味不明な大量のエラーが出る可能性がある。
`stdint.h` がシャドウされるなど変なことが起きうる。

https://mesonbuild.com/Reference-manual_functions.html#library_implicit_include_directories

必要に応じて `implicit_include_directories: false` を明示する。
:::

## link

```meson.build
# winmm.lib にリンクする
c_compiler = meson.get_compiler('c')
winmm_lib = c_compiler.find_library('winmm', required: true)
executable('hello', [
  'main.cpp'
],
  dependencies: [winmm_lib],
)
```

## 条件式

```meson
if host_machine.system() == 'windows'
endif
```

## config.h を生成する

```py
project(
    'App',
    'cpp',
    version: '1.4.0',
    license: 'MIT',
    default_options: [],
)

cdata = configuration_data()
cdata.set_quoted('PACKAGE', meson.project_name())
cdata.set_quoted('PACKAGE_VERSION', meson.project_version())
configure_file(
    output: 'config.h',
    configuration: cdata,
)

# build_dir に config.h は出力される
# include できるようにするには下記のようにする
# '.' は build_dir を指すぽい。
config_inc = include_directories('.')
```

生成された `config.h`

```c
/*
 * Autogenerated by the Meson build system.
 * Do not edit, your changes will be lost.
 */

#pragma once

#define PACKAGE "App"

#define PACKAGE_VERSION "1.4.0"
```

GIT の情報を埋め込む例

[meson and git information](https://app.slack.com/client/TBV0XKV40/CCJUCGTDG)


